# 投资组合优化环境 (PortfolioOptimizationEnv, POE)

该环境通过强化学习代理模拟了一个定期再平衡的投资组合在市场中的表现。在每个时间步 $t$，代理负责确定一个投资组合向量 $W_{t}$，其中包含对每只股票的投资比例。然后，环境利用用户提供的数据来模拟新投资组合在时间步 $t+1$ 的价值。

有关此问题的详细公式，请参阅以下论文：

[POE: 适用于 FinRL 的通用投资组合优化环境](https://doi.org/10.5753/bwaif.2023.231144)
```
@inproceedings{bwaif,
 author = {Caio Costa 和 Anna Costa},
 title = {POE: 适用于 FinRL 的通用投资组合优化环境},
 booktitle = {第二届巴西金融领域人工智能研讨会论文集},
 location = {João Pessoa/PB},
 year = {2023},
 keywords = {},
 issn = {0000-0000},
 pages = {132--143},
 publisher = {SBC},
 address = {Porto Alegre, RS, Brasil},
 doi = {10.5753/bwaif.2023.231144},
 url = {https://sol.sbc.org.br/index.php/bwaif/article/view/24959}
}
```


## 输入
该环境基于用户提供的数据框模拟了代理与金融市场之间的交互。数据框包含用户定义的时间序列特征（例如收盘价、最高价和最低价），并且必须具有时间和 tic 列，分别列出日期时间和股票代码。
以下是数据框的一个示例：

    date        high            low             close           tic
0   2020-12-23  0.157414        0.127420        0.136394        ADA-USD
1   2020-12-23  34.381519       30.074295       31.097898       BNB-USD
2   2020-12-23  24024.490234    22802.646484    23241.345703    BTC-USD
3   2020-12-23  0.004735        0.003640        0.003768        DOGE-USD
4   2020-12-23  637.122803      560.364258      583.714600      ETH-USD
... ...         ...             ...             ...             ...


## 动作
在每个时间步，环境期望的动作是一个一维 Box，形状为 (n+1,)，其中 $n$ 是投资组合中股票的数量。这个动作被称为 *投资组合向量*，它包含剩余现金和每只股票的资金分配比例。

例如：给定一个包含三只股票的投资组合，一个有效的投资组合向量为 $W_{t} = [0.25, 0.4, 0.2, 0.15]$。在这个例子中，25% 的资金未投资（剩余现金），40% 投资于股票 1，20% 投资于股票 2，15% 投资于股票 3。

**注意：** 投资组合向量中值的总和应等于（或非常接近）1。如果不满足，POE 将应用 softmax 归一化。

## 观测
在仿真过程中，POE 可以返回两种类型的观测：Dict 或 Box。

- Box 是一个三维数组，形状为 $(f, n, t)$，其中 $f$ 是特征的数量，$n$ 是投资组合中股票的数量，$t$ 是时间序列窗口。这种观测基本上仅包含代理的当前状态。

- 另一方面，Dict 表示法是一个字典，包含状态和最后一个投资组合向量，如下所示：

```json
{
"state": "三维 Box (f, n, t 表示时间序列)",
"last_action": "一维 Box (n+1,) 表示投资组合权重"
}
```


## 奖励
给定时间步 $t$ 的仿真结果，奖励由以下公式给出：$r_{t} = ln(V_{t}/V_{t-1})$，其中 $V_{t}$ 是时间 $t$ 的投资组合价值。使用此公式，当由于再平衡导致投资组合价值下降时，奖励为负；否则为正。

## 示例
使用此环境的 Jupyter Notebook 示例可以在此处找到：[链接](/examples/FinRL_PortfolioOptimizationEnv_Demo.ipynb)。